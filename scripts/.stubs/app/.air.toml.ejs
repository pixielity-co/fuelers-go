# ─────────────────────────────────────────────
# Fuelers Monorepo - Advanced Air Configuration
# Optimized for TurboRepo + Go Workspaces
# Service: apps/<%= name %>
# ─────────────────────────────────────────────

# Root of this service
root = "."
tmp_dir = "tmp"

# ─────────────────────────────────────────────
# BUILD CONFIGURATION
# ─────────────────────────────────────────────
[build]

# Output binary (kept inside tmp to avoid repo pollution)
bin = "tmp/app"

# Build command
cmd = "go build -o ./tmp/app ./src/main.go"

# Delay before rebuild (milliseconds)
delay = 200

# Extensions that trigger rebuild
include_ext = [
  "go",
  "tpl",
  "tmpl",
  "html",
  "yaml",
  "yml",
  "json",
  "env"
]

# Ignore directories (VERY important for monorepo stability)
exclude_dir = [
  "tmp",
  "bin",
  "vendor",
  "node_modules",
  ".git",
  ".turbo",
  "dist",
  "docker",
]

# Ignore specific files
exclude_file = [
  ".air.toml",
  "Dockerfile"
]

# Ignore regex patterns (prevents rebuild loops)
exclude_regex = [
  "_test.go",
  ".*\\.tmp",
  ".*\\.swp"
]

# Follow symlinks (important for go.work)
follow_symlink = true

# Restart even if checksum unchanged
rerun = true

# Stop previous process if build fails
stop_on_error = true

# Delay before killing previous process
kill_delay = "500ms"

# Build log file
log = "air-build.log"

# ─────────────────────────────────────────────
# RUN CONFIGURATION
# ─────────────────────────────────────────────
[run]

# Execute compiled binary directly
full_bin = "./tmp/app"

# Auto restart after rebuild
restart = true

# Graceful shutdown support
send_interrupt = true

# Load environment variables automatically
env_file = "env/.env"

# ─────────────────────────────────────────────
# LOGGING CONFIGURATION
# ─────────────────────────────────────────────
[log]
time = true
color = true

# Color theme for better DX
[color]
main = "cyan"
watcher = "yellow"
build = "green"
runner = "magenta"

# ─────────────────────────────────────────────
# MISC SETTINGS
# ─────────────────────────────────────────────
[misc]

# Do not use polling (better performance on macOS/Linux)
poll = false

# Clean temp files when Air exits
clean_on_exit = true
