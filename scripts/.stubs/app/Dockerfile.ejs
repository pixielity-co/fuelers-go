# ─── Stage 1: Build ──────────────────────────────────────────
#
# Builds the <%= nameTitle %> service binary.
#
FROM golang:1.23-alpine AS builder

WORKDIR /app

# Copy this application's module only (deps are resolved via GitHub registry)
COPY apps/<%= name %> ./apps/<%= name %>/

# Download Go module dependencies
RUN go mod download -C apps/<%= name %>

# Build the binary
RUN CGO_ENABLED=0 GOOS=linux go build \
    -ldflags="-w -s" \
    -o /bin/<%= name %> \
    ./apps/<%= name %>/src/main.go

# ─── Stage 2: Runtime ───────────────────────────────────────
FROM alpine:latest

# Install CA certificates for HTTPS and timezone data
RUN apk --no-cache add ca-certificates tzdata

WORKDIR /

COPY --from=builder /bin/<%= name %> /<%= name %>

EXPOSE 8080

ENTRYPOINT ["/<%= name %>"]
