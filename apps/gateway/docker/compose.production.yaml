# ─────────────────────────────────────────────────────────────────────────────
# Fuelers Monorepo - Production Specification
# Service: Gateway
# ─────────────────────────────────────────────────────────────────────────────
#
# Definition for the Gateway production environment.
# Optimized for high availability, security, and resource efficiency.
# ─────────────────────────────────────────────────────────────────────────────

services:
  gateway:
    build:
      context: ../../..
      dockerfile: apps/gateway/docker/Dockerfile
    container_name: gateway-app-prod
    ports:
      - "${APP_PORT:-8080}:8080"
    env_file:
      - ../env/.env
    environment:
      - ENV=production
      - GO_ENV=production
    restart: always
    read_only: true
    tmpfs:
      - /tmp
    deploy:
      resources:
        limits:
          cpus: "0.50"
          memory: 512M
        reservations:
          cpus: "0.10"
          memory: 128M
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 3
    logging:
      driver: "json-file"
      options:
        max-size: "100m"
        max-file: "5"
    security_opt:
      - no-new-privileges:true
